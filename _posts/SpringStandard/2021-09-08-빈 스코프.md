---
title:  "빈 생명주기"
excerpt: "인프런 김영한"
categories:
  - Education
tag:
  - Spring
toc: true
---

# 빈 스코프
스프링 빈은 기본적으로 싱글톤으로 생성되기 때문에 컨테이너의 시작과 함께 생성되어 종료될때까지 유지된다.  
스코프는 번역 그대로 빈이 존재할 수 있는 범위를 뜻한다.


**스프링의 스코프 지원**
- 싱글톤 : 기본 스코프로 컨테이너 시작과 종료까지 유지되는 가장 넓은 범위의 스코프다.
- 프로토타입 : 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프다.
- 웹 관련 스코프
  * request : 웹 요청이 들어오고 나갈때까지 유지된다.
  * sessopm : 웹 세션이 생성되고 종료될때까지 유지된다.
  * application : 웹의 서블릿 컨텍스와 같은 범위로 유지되는 스코프다.
  
  
**자동 등록**

``` java
@Scope("prototype")
@Component
public class HelloBean{}
```


**수동 등록**

``` java
@Scope("prototype")
@Bean
PrototypeBean HelloBean() {
	return new PrototypeBean;
}
```

## 프로토타입 스코프
싱글톤 스코프 빈은 항상 같은 인스턴스를 반환하는 반면에 프로토타입 스코프는 항상 새로운 인스턴스를 생성해서 반환한다.

1. 클라이언트에 요청이 왔을때 빈을 생성한다.
1. 빈 생성 후 의존관계를 주입한다.
1. 프로토타입 빈을 클라이언트에 반환한다.
1. 이후 같은 요청이 와도 1번부터 다시 진행한다. 

>핵심은 스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입하고, 초기화까지만 처리한다.  
>관리할 책임은 호출한 클라이언트에 있으며 @PreDestory 같은 종료 메서드는 호출되지 않는다.

``` java
public class PrototypeTest {

    @Test
    void prototypeBeanFind(){
        //직접 등록 컴포넌트 스캔을 자동으로 해줌
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        System.out.println("find prototypeZBean 1");
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        System.out.println("find prototypeZBean 2");
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);

        System.out.println("singletonBean1 = " + prototypeBean1);
        System.out.println("singletonBean2 = " + prototypeBean2);
		// 서로 다른 객체로 확인
        Assertions.assertThat(prototypeBean1).isNotSameAs(prototypeBean2);
		
		//@PreDestroy 호출되지 않아 직접 호출 필요
		prototypeBean1.destroy()
		
        ac.close();
    }
    @Scope("prototype")
    static class PrototypeBean{
        @PostConstruct
        public void init() {
            System.out.println("singleton init");
        }

			//호출 되지 않음
        @PreDestroy
        public void destroy() {
            System.out.println("singleton destory");
        }
    }
}
```